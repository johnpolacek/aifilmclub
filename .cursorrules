# Cursor Rules

## Logging Guidelines

- Always use `JSON.stringify()` for console.log, console.error, and console.warn when logging objects or complex data structures
- Include the third parameter `null, 2` for pretty-printing: `JSON.stringify(data, null, 2)`
- This makes logs easy to copy/paste for debugging and sharing
- Example: `console.log("[Component] Event:", JSON.stringify({ key: value }, null, 2))`

## Code Style

- Prefer using `search_replace` and `write` tools for file editing over terminal commands
- Use TypeScript for type safety
- Follow existing code patterns and conventions

## S3 Storage Path Conventions (CRITICAL)

All user-uploaded and AI-generated media MUST follow these path conventions:

### Project-Scoped Paths
All scene-related media belongs under the project directory:

```
projects/{projectId}/scenes/{sceneId}/videos/{filename}.mp4     # Video files
projects/{projectId}/scenes/{sceneId}/thumbnails/{filename}.jpg  # Video thumbnails
projects/{projectId}/scenes/{sceneId}/images/{filename}.jpg     # Generated/uploaded images
projects/{projectId}/scenes/{sceneId}/audios/{filename}.mp3     # Audio files
```

### Other Project Assets
```
projects/{username}/files/{filename}           # Project files (PDFs, screenplays)
thumbnails/{username}/{filename}               # Project thumbnails
characters/{username}/{filename}               # Character images
locations/{username}/{filename}                # Location images
posts/{username}/{filename}                    # Post images
avatars/{username}/{filename}                  # User avatars
```

### Key Rules

1. **NEVER use `generated/` prefix** - This is incorrect and inconsistent with the codebase
2. **Always use `projects/{projectId}/scenes/{sceneId}/` for scene media**
3. **Use `{mediaType}s/` (plural) for the folder name** - e.g., `videos/`, `thumbnails/`, `images/`, `audios/`
4. **Include timestamp in filename** for cache busting: `video-{timestamp}-{randomId}.mp4`
5. **Reference existing code** - See `app/api/presigned-upload/route.ts` and `app/api/scenes/upload-media/route.ts` for canonical examples

### Example: Correct vs Incorrect

❌ WRONG: `generated/videos/{projectId}/{sceneId}/{filename}.mp4`
✅ RIGHT: `projects/{projectId}/scenes/{sceneId}/videos/{filename}.mp4`

❌ WRONG: `generated/thumbnails/{projectId}/{sceneId}/{filename}.jpg`
✅ RIGHT: `projects/{projectId}/scenes/{sceneId}/thumbnails/{filename}.jpg`

### S3 Bucket
- Bucket name: `aifilmcamp-public`
- CloudFront distribution serves from this bucket

